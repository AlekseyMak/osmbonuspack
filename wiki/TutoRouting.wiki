#summary Routing Tutorial.



= 1. Hello Routing World =

Let's assume you have a super-simple Android application using osmdroid, and displaying a map in an activity. Typically, that:

{{{
public class MapActivity extends Activity {

    @Override public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);        
        map = (MapView) findViewById(R.id.map);
        map.setTileSource(TileSourceFactory.MAPNIK);
        GeoPoint startPoint = new GeoPoint(48.13, -1.63)
        MapController mapController = map.getController();
        mapController.setCenter(startPoint);
	mapController.setZoom(9);
    }
}
}}}

You want to display a route on your map. 
First, get a road manager:
{{{
	RoadManager roadManager = new OSRMRoadManager();
}}}

Then, retreive the road between your start and end point:

{{{
	ArrayList<GeoPoint> waypoints = new ArrayList<GeoPoint>();
	waypoints.add(startPoint);
	waypoints.add(new GeoPoint(48.4, -1.9)); //end point
	Road road = roadManager.getRoad(waypoints);
}}}

then, build an overlay with the route shape:
{{{
	PathOverlay roadOverlay = RoadManager.buildRoadOverlay(road, map.getContext());
}}}

Add this overlay to the overlays of your map:
{{{
	map.getOverlays().add(roadOverlay);
}}}
Okay, now refresh the map:
{{{
	map.invalidate();
}}}

= 2. Playing with the RoadManager =

- Okay, but I wanted this route for bicycles... 

- First, change to MapQuestRoadManager, as it supports bicycle routes. One word to change, not too complicated:
{{{
	RoadManager roadManager = new MapQuestRoadManager();
}}}
Then set appropriate option (before getting the road):
{{{
	roadManager.addRequestOption("routeType=bicycle");
}}}

Done. 

= 3. Showing the Route steps on the map =

I'm sure you will soon want to add nice bubbles. So, let's use ItemizedOverlayWithBubble. First, put the resources: 
 * in your res/layout: bonuspack_bubble.xml
 * and in res/drawable-mpi: bonuspack_bubble.9.png
You will get both in OSMBonusPackDemo res files. 

Then, we can create the overlay and put it in the map:
{{{
final ArrayList<ExtendedOverlayItem> roadItems = new ArrayList<ExtendedOverlayItem>();
ItemizedOverlayWithBubble<ExtendedOverlayItem> roadNodes = new ItemizedOverlayWithBubble<ExtendedOverlayItem>(this, roadItems, map);
map.getOverlays().add(roadNodes);
}}}

Once the road has been retrieved, populate the nodes overlay:

{{{
    	Drawable marker = getResources().getDrawable(R.drawable.marker_node);
    	for (int i=0; i<road.mNodes.size(); i++){
    		RoadNode node = road.mNodes.get(i);
    		ExtendedOverlayItem nodeMarker = new ExtendedOverlayItem("Step "+i, "", node.mLocation);
    		nodeMarker.setMarkerHotspot(OverlayItem.HotspotPlace.CENTER);
    		nodeMarker.setMarker(marker);
    		roadNodes.addItem(nodeMarker);
    	}
}}}

Here we are! Clicking on a step marker will open its bubble. 
